# PSN-30 Architecture Diagrams

**For**: Visual reference for PSN-30 design
**Date**: 2025-11-20

---

## 1. Current Architecture (Routing Pattern)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER                                 â”‚
â”‚              /ccpm:work PSN-27                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Natural Command (work.md)                      â”‚
â”‚                                                              â”‚
â”‚  Step 1: Parse arguments                         [~2,000]   â”‚
â”‚  Step 2: Fetch issue (Linear MCP)                [~3,000]   â”‚
â”‚  Step 3: Detect mode (start/resume)              [~1,000]   â”‚
â”‚  Step 4: Route via SlashCommand                  [~1,000]   â”‚
â”‚                                                              â”‚
â”‚  Total: ~7,000 tokens                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“ SlashCommand Tool
                         â”‚ [~3,000 tokens overhead]
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Underlying Command (implementation:start.md)          â”‚
â”‚                                                              â”‚
â”‚  Step 1: Parse arguments AGAIN                   [~2,000]   â”‚
â”‚  Step 2: Fetch issue AGAIN (Linear MCP)          [~3,000]   â”‚
â”‚  Step 3: Analyze codebase                        [~2,000]   â”‚
â”‚  Step 4: Update Linear (multiple calls)          [~2,000]   â”‚
â”‚  Step 5: Display results                         [~1,000]   â”‚
â”‚                                                              â”‚
â”‚  Total: ~10,000 tokens                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TOTAL: ~20,000 tokens
PROBLEMS:
  â€¢ Double context loading (work.md + implementation:start.md)
  â€¢ Repeated argument parsing (2x)
  â€¢ Duplicate Linear fetches (2x)
  â€¢ SlashCommand overhead (3,000 tokens)
```

---

## 2. Target Architecture (Direct Implementation)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER                                 â”‚
â”‚              /ccpm:work PSN-27                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Natural Command (work.md) - DIRECT                  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Step 1: Parse Arguments & Detect Context           â”‚    â”‚
â”‚  â”‚   - Parse args ONCE                      [~200]    â”‚    â”‚
â”‚  â”‚   - Git detection if needed              [~150]    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Step 2: Fetch State (via Linear Subagent)          â”‚    â”‚
â”‚  â”‚   Task(linear-operations):                         â”‚    â”‚
â”‚  â”‚     operation: get_issue                           â”‚    â”‚
â”‚  â”‚     cache: true                          [~200]    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Step 3: Execute Mode Logic                          â”‚    â”‚
â”‚  â”‚   - Detect mode (start/resume)           [~300]    â”‚    â”‚
â”‚  â”‚   - If start: analyze codebase                     â”‚    â”‚
â”‚  â”‚     Task(...): smart selection         [~1,500]    â”‚    â”‚
â”‚  â”‚   - If resume: display progress          [~300]    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Step 4: Update Linear (via Subagent - Batched)     â”‚    â”‚
â”‚  â”‚   Task(linear-operations):                         â”‚    â”‚
â”‚  â”‚     operation: update_issue (batch)                â”‚    â”‚
â”‚  â”‚     + create_comment                     [~550]    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Step 5: Display Results & Interactive Menu          â”‚    â”‚
â”‚  â”‚   - Formatted output                     [~600]    â”‚    â”‚
â”‚  â”‚   - AskUserQuestion (next actions)                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  Total: ~3,500 tokens (START mode)                          â”‚
â”‚         ~1,850 tokens (RESUME mode)                         â”‚
â”‚  With 15% buffer: ~4,100 / ~2,200 tokens                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TOTAL: ~5,000 tokens (START mode) | ~2,500 tokens (RESUME mode)

BENEFITS:
  âœ… Single context load (no routing)
  âœ… Parse arguments once
  âœ… Linear subagent with caching (85-95% hit rate)
  âœ… Batch updates (single MCP call)
  âœ… No SlashCommand overhead

REDUCTION: 75% (START) | 88% (RESUME)
```

---

## 3. Linear Subagent Integration Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Natural Command                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Task(linear-operations): `
                         â”‚   operation: get_issue
                         â”‚   params: { issue_id: "PSN-27" }
                         â”‚   context: { cache: true }
                         â”‚ `
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Linear Operations Subagent                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     Session-Level In-Memory Cache                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Teams   â”‚ Projects â”‚  Labels  â”‚   Statuses   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  by ID   â”‚  by ID   â”‚  by Team â”‚   by Team    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  by Name â”‚  by Name â”‚  by Name â”‚   by Name    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  Cache Hit? â”€â”€â”€â”€â”                                    â”‚  â”‚
â”‚  â”‚                 â”‚                                     â”‚  â”‚
â”‚  â”‚        YES â†â”€â”€â”€â”€â”¤                                     â”‚  â”‚
â”‚  â”‚         â†“       â”‚                                     â”‚  â”‚
â”‚  â”‚    Return       â”‚                                     â”‚  â”‚
â”‚  â”‚    (50ms)       â”‚                                     â”‚  â”‚
â”‚  â”‚                 â”‚                                     â”‚  â”‚
â”‚  â”‚        NO â†â”€â”€â”€â”€â”€â”˜                                     â”‚  â”‚
â”‚  â”‚         â†“                                             â”‚  â”‚
â”‚  â”‚    Call MCP                                           â”‚  â”‚
â”‚  â”‚    Update Cache                                       â”‚  â”‚
â”‚  â”‚    Return (500ms)                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â†“                                    â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚                    â”‚ MCP Callâ”‚ (if cache miss)               â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Linear MCP Server                              â”‚
â”‚          (23 tools: get_issue, create_issue, etc.)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Linear API                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CACHE HIT RATES:
  â€¢ Teams: 95%+ (rarely changes)
  â€¢ Projects: 90%+ (infrequent changes)
  â€¢ Labels: 85%+ (moderate changes)
  â€¢ Statuses: 90%+ (rare changes)
  â€¢ Issues: 70%+ (session-level reuse)

PERFORMANCE:
  â€¢ Cached: <50ms (in-memory lookup)
  â€¢ Uncached: <500ms (MCP + cache update)
  â€¢ Batch operations: <800ms (parallel MCP)
```

---

## 4. Token Reduction Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Command: /ccpm:work                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

BASELINE (No Optimization)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Natural Command:      7,000 tokens   â”‚
â”‚ SlashCommand Tool:    3,000 tokens   â”‚
â”‚ Underlying Command:  10,000 tokens   â”‚
â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚ TOTAL:               20,000 tokens   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

WITH PSN-29 ONLY (Linear Subagent)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Natural Command:      5,000 tokens   â”‚  (-28%)
â”‚ SlashCommand Tool:    3,000 tokens   â”‚
â”‚ Underlying Command:   5,000 tokens   â”‚  (-50%)
â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚ TOTAL:               13,000 tokens   â”‚  (-35%)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

WITH PSN-30 (Direct Implementation + Linear Subagent)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Natural Command:      5,000 tokens   â”‚  (-75%)
â”‚ SlashCommand Tool:        0 tokens   â”‚  (-100%)
â”‚ Underlying Command:       0 tokens   â”‚  (-100%)
â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚ TOTAL:                5,000 tokens   â”‚  (-75%)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

COMBINED REDUCTION: 75% (20,000 â†’ 5,000 tokens)

BREAKDOWN OF SAVINGS:
  â€¢ Eliminate routing:         -3,000 (15%)
  â€¢ Eliminate duplicate parse: -2,000 (10%)
  â€¢ Linear subagent caching:   -6,000 (30%)
  â€¢ Batch operations:          -2,000 (10%)
  â€¢ Eliminate duplicate fetch: -2,000 (10%)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  TOTAL SAVINGS:              -15,000 (75%)
```

---

## 5. Command Flow Comparison (Side-by-Side)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ROUTING PATTERN (OLD)      â”‚   DIRECT PATTERN (NEW)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                â”‚                                â”‚
â”‚ User: /ccpm:work PSN-27        â”‚ User: /ccpm:work PSN-27        â”‚
â”‚   â†“                            â”‚   â†“                            â”‚
â”‚ work.md loads (7,000 tokens)   â”‚ work.md loads (5,000 tokens)   â”‚
â”‚   â†“                            â”‚   â†“                            â”‚
â”‚ Parse arguments                â”‚ Parse arguments ONCE           â”‚
â”‚   â†“                            â”‚   â†“                            â”‚
â”‚ Fetch issue (Linear MCP)       â”‚ Fetch issue (subagent, cached) â”‚
â”‚   â†“                            â”‚   â†“                            â”‚
â”‚ Detect mode (start/resume)     â”‚ Detect mode (start/resume)     â”‚
â”‚   â†“                            â”‚   â†“                            â”‚
â”‚ Route via SlashCommand         â”‚ Execute mode logic INLINE      â”‚
â”‚   â†“ (+3,000 tokens)            â”‚   â†“                            â”‚
â”‚ implementation:start.md loads  â”‚ (no additional load)           â”‚
â”‚   â†“ (+10,000 tokens)           â”‚   â†“                            â”‚
â”‚ Parse arguments AGAIN          â”‚ (already parsed)               â”‚
â”‚   â†“                            â”‚   â†“                            â”‚
â”‚ Fetch issue AGAIN (Linear MCP) â”‚ (already fetched, cached)      â”‚
â”‚   â†“                            â”‚   â†“                            â”‚
â”‚ Analyze codebase               â”‚ Analyze codebase (smart agent) â”‚
â”‚   â†“                            â”‚   â†“                            â”‚
â”‚ Update Linear (3 calls)        â”‚ Update Linear (1 batch call)   â”‚
â”‚   â†“                            â”‚   â†“                            â”‚
â”‚ Display results                â”‚ Display results + interactive  â”‚
â”‚   â†“                            â”‚   â†“                            â”‚
â”‚ TOTAL: ~20,000 tokens          â”‚ TOTAL: ~5,000 tokens           â”‚
â”‚ TIME: ~10-15 seconds           â”‚ TIME: ~3-5 seconds             â”‚
â”‚                                â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

KEY DIFFERENCES:
  âœ— Double context load         â†’  âœ“ Single context load
  âœ— Duplicate parsing            â†’  âœ“ Parse once
  âœ— Duplicate Linear fetch       â†’  âœ“ Fetch once (cached)
  âœ— Multiple Linear updates      â†’  âœ“ Batch updates
  âœ— SlashCommand overhead        â†’  âœ“ Direct execution
```

---

## 6. Implementation Phases Flowchart

```
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   PSN-30 Start  â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚               â”‚               â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
            â”‚   Phase 1   â”‚ â”‚  Phase 2   â”‚ â”‚  Phase 3   â”‚
            â”‚   Week 1    â”‚ â”‚   Week 2   â”‚ â”‚   Week 3   â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                   â”‚               â”‚               â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚               â”‚
         â”‚         â”‚         â”‚    â”‚               â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”â”Œâ”€â”€â”€â–¼â”€â”€â”€â”â”Œâ”€â”€â”€â–¼â”€â”€â”€â”â”‚               â”‚
    â”‚ work   â”‚â”‚ sync  â”‚â”‚ done  â”‚â”‚               â”‚
    â”‚ 67%    â”‚â”‚ 63%   â”‚â”‚ 63%   â”‚â”‚               â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜â””â”€â”€â”€â”¬â”€â”€â”€â”˜â””â”€â”€â”€â”¬â”€â”€â”€â”˜â”‚               â”‚
         â”‚        â”‚        â”‚    â”‚               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚               â”‚
                  â”‚             â”‚               â”‚
            â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”       â”‚               â”‚
            â”‚   Test    â”‚       â”‚               â”‚
            â”‚  Measure  â”‚       â”‚               â”‚
            â”‚  Monitor  â”‚       â”‚               â”‚
            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â”‚               â”‚
                  â”‚             â”‚               â”‚
                  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”        â”‚
                  â”‚      â”‚      â”‚      â”‚        â”‚
                  â”‚   â”Œâ”€â”€â–¼â”€â”€â”â”Œâ”€â”€â–¼â”€â”€â”â”Œâ”€â”€â–¼â”€â”€â”    â”‚
                  â”‚   â”‚plan â”‚â”‚plan â”‚â”‚plan â”‚    â”‚
                  â”‚   â”‚creatâ”‚â”‚plan â”‚â”‚updatâ”‚    â”‚
                  â”‚   â”‚65%  â”‚â”‚64%  â”‚â”‚66%  â”‚    â”‚
                  â”‚   â””â”€â”€â”¬â”€â”€â”˜â””â”€â”€â”¬â”€â”€â”˜â””â”€â”€â”¬â”€â”€â”˜    â”‚
                  â”‚      â”‚      â”‚      â”‚        â”‚
                  â”‚      â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜        â”‚
                  â”‚             â”‚               â”‚
                  â”‚       â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”         â”‚
                  â”‚       â”‚   Test    â”‚         â”‚
                  â”‚       â”‚  Measure  â”‚         â”‚
                  â”‚       â”‚  Monitor  â”‚         â”‚
                  â”‚       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â”‚
                  â”‚             â”‚               â”‚
                  â”‚             â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
                  â”‚             â”‚        â”‚      â”‚      â”‚
                  â”‚             â”‚     â”Œâ”€â”€â–¼â”€â”€â”â”Œâ”€â”€â–¼â”€â”€â”  â”‚
                  â”‚             â”‚     â”‚verifâ”‚â”‚commâ”‚  â”‚
                  â”‚             â”‚     â”‚61%  â”‚â”‚opt â”‚  â”‚
                  â”‚             â”‚     â””â”€â”€â”¬â”€â”€â”˜â””â”€â”€â”¬â”€â”€â”˜  â”‚
                  â”‚             â”‚        â”‚      â”‚     â”‚
                  â”‚             â”‚        â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”˜
                  â”‚             â”‚               â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                          â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
                          â”‚  Complete â”‚
                          â”‚ 64% avg   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SUCCESS CRITERIA PER PHASE:
  â€¢ Token reduction â‰¥60%
  â€¢ No functionality regressions
  â€¢ Error rate <2%
  â€¢ Positive user feedback
```

---

## 7. Data Flow: Command Execution

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER INPUT                                  â”‚
â”‚                 /ccpm:work PSN-27                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 1. PARSE & DETECT                  â”‚
        â”‚                                    â”‚
        â”‚ â€¢ Parse arguments                  â”‚
        â”‚ â€¢ Validate issue ID format         â”‚
        â”‚ â€¢ Git detection if needed          â”‚
        â”‚                                    â”‚
        â”‚ Result: issueId = "PSN-27"         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 2. FETCH STATE (Linear Subagent)   â”‚
        â”‚                                    â”‚
        â”‚ Task(linear-operations):           â”‚
        â”‚   operation: get_issue             â”‚
        â”‚   issue_id: "PSN-27"               â”‚
        â”‚   cache: true                      â”‚
        â”‚                                    â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
        â”‚ â”‚ Cache Hit? (85-95%)  â”‚           â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
        â”‚        â”‚                            â”‚
        â”‚   YES â”€â”¼â”€ NO                        â”‚
        â”‚   50ms â”‚ 500ms                      â”‚
        â”‚        â”‚                            â”‚
        â”‚ Result: issue { id, title, state,  â”‚
        â”‚         team, labels, ... }        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 3. DETECT MODE                     â”‚
        â”‚                                    â”‚
        â”‚ if status in START_STATUSES:       â”‚
        â”‚   mode = 'start'                   â”‚
        â”‚ elif status in IN_PROGRESS:        â”‚
        â”‚   mode = 'resume'                  â”‚
        â”‚ else:                              â”‚
        â”‚   mode = 'resume' (fallback)       â”‚
        â”‚                                    â”‚
        â”‚ Result: mode = "start"             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 4A. EXECUTE MODE LOGIC (START)     â”‚
        â”‚                                    â”‚
        â”‚ â€¢ Analyze codebase:                â”‚
        â”‚   Task(...): smart agent selection â”‚
        â”‚     "Analyze for: ${issue.title}"  â”‚
        â”‚                                    â”‚
        â”‚ Result: analysis { files, deps,    â”‚
        â”‚         tests, risks, approach }   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 4B. UPDATE LINEAR (Batched)        â”‚
        â”‚                                    â”‚
        â”‚ Task(linear-operations):           â”‚
        â”‚   operation: update_issue          â”‚
        â”‚   issue_id: "PSN-27"               â”‚
        â”‚   state: "In Progress"             â”‚
        â”‚   labels: ["implementation"]       â”‚
        â”‚                                    â”‚
        â”‚ Task(linear-operations):           â”‚
        â”‚   operation: create_comment        â”‚
        â”‚   issue_id: "PSN-27"               â”‚
        â”‚   body: "Started: ${analysis}"     â”‚
        â”‚                                    â”‚
        â”‚ Result: issue updated, comment     â”‚
        â”‚         created                    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 5. DISPLAY RESULTS                 â”‚
        â”‚                                    â”‚
        â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
        â”‚ âœ… Work Started                    â”‚
        â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
        â”‚                                    â”‚
        â”‚ ğŸ“‹ Issue: PSN-27                   â”‚
        â”‚ ğŸ“ Title: [title]                  â”‚
        â”‚ ğŸ“Š Status: In Progress             â”‚
        â”‚                                    â”‚
        â”‚ [Analysis summary]                 â”‚
        â”‚                                    â”‚
        â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 6. INTERACTIVE MENU                â”‚
        â”‚                                    â”‚
        â”‚ AskUserQuestion:                   â”‚
        â”‚   "What would you like to do       â”‚
        â”‚    next?"                          â”‚
        â”‚                                    â”‚
        â”‚   Options:                         â”‚
        â”‚   1. Save Progress (/ccpm:sync)    â”‚
        â”‚   2. View Status (/ccpm:utils:     â”‚
        â”‚      status)                       â”‚
        â”‚   3. Other                         â”‚
        â”‚                                    â”‚
        â”‚ User selects â†’ Execute action      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TOTAL TIME: 3-5 seconds
TOTAL TOKENS: ~5,000 (75% reduction from baseline)
```

---

## 8. Token Cost Breakdown by Operation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              TOKEN COST PER OPERATION                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Operation                 â”‚  Tokens  â”‚  Notes               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Frontmatter + imports     â”‚    200   â”‚  Minimal boilerplate â”‚
â”‚ Argument parsing          â”‚    200   â”‚  Standard pattern    â”‚
â”‚ Git branch detection      â”‚    150   â”‚  Bash + regex        â”‚
â”‚ Linear get_issue (cached) â”‚    200   â”‚  YAML + parse        â”‚
â”‚ Linear get_issue (uncache)â”‚    600   â”‚  Full object         â”‚
â”‚ Linear create_issue       â”‚    400   â”‚  With 2-3 labels     â”‚
â”‚ Linear update_issue       â”‚    300   â”‚  Batch 3-4 fields    â”‚
â”‚ Linear create_comment     â”‚    250   â”‚  Standard comment    â”‚
â”‚ Smart agent analysis      â”‚  1,500   â”‚  Codebase review     â”‚
â”‚ Quality checks (inline)   â”‚    400   â”‚  Bash commands       â”‚
â”‚ Display + interactive menuâ”‚    600   â”‚  Formatted + Ask     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TYPICAL COMMAND COMPOSITION:

/ccpm:work (START mode):
  Base:        200
  Parse:       200
  Git detect:  150
  Get issue:   200 (cached)
  Analysis:  1,500 (smart agent)
  Update:      300 (batch)
  Comment:     250
  Display:     600
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Total:     3,400
  Buffer:      600 (15%)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Target:    4,000 tokens

/ccpm:sync:
  Base:        200
  Parse:       200
  Git detect:  150
  Git changes: 200
  Comment:     250
  Display:     600
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Total:     1,600
  Buffer:      240 (15%)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Target:    1,850 tokens

/ccpm:done:
  Base:        200
  Parse:       200
  Git checks:  300 (branch, push, uncommitted)
  Get issue:   200 (cached)
  Create PR:   600 (GitHub MCP)
  Update:      300 (batch)
  Comment:     250
  Display:     600
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Total:     2,650
  Buffer:      400 (15%)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Target:    3,050 tokens
```

---

**End of Architecture Diagrams**
