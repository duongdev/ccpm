{
  "$schema": "https://code.claude.com/schemas/settings.json",
  "description": "CCPM Plugin Hooks - Smart agent auto-invocation, TDD enforcement, and quality gates",
  "hooks": {
    "UserPromptSubmit": [
      {
        "hooks": [
          {
            "type": "prompt",
            "promptFile": "./hooks/smart-agent-selector.prompt",
            "timeout": 20000,
            "description": "SMART agent selector: Dynamically discovers all agents (global, plugins, project) and selects best matches using scoring algorithm"
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "matcher": "Write|Edit|NotebookEdit",
        "hooks": [
          {
            "type": "prompt",
            "promptFile": "./hooks/tdd-enforcer.prompt",
            "timeout": 10000,
            "description": "Enforces TDD: Tests must be written before production code"
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "prompt",
            "promptFile": "./hooks/quality-gate.prompt",
            "timeout": 15000,
            "description": "Quality gate: Automatically invokes code review and security agents after implementation"
          }
        ]
      }
    ],
    "SubagentStop": [
      {
        "hooks": [
          {
            "type": "prompt",
            "prompt": "A subagent just completed its task.\n\nSubagent: {{subagentName}}\nTask: {{taskDescription}}\nResult: {{result}}\n\nAnalyze if:\n1. The subagent completed successfully\n2. Additional agents should be chained (e.g., after implementation, run code-reviewer)\n3. Any follow-up work is needed\n\nRespond with JSON:\n{\n  \"decision\": \"approve\",\n  \"shouldChainAgents\": true|false,\n  \"nextAgents\": [\"agent-name\"],\n  \"reasoning\": \"why chain these agents\",\n  \"systemMessage\": \"message to user\"\n}",
            "timeout": 10000,
            "description": "Agent chaining: Determines if more agents should run after subagent completion"
          }
        ]
      }
    ]
  },
  "usage": {
    "installation": "This file is automatically applied when the CCPM plugin is installed",
    "customization": "Users can disable specific hooks in their project's .claude/settings.json"
  },
  "notes": {
    "agent_selector": {
      "purpose": "Analyzes every user prompt to determine which agents should be invoked",
      "trigger": "UserPromptSubmit",
      "execution": "Before Claude starts responding",
      "output": "Injects agent invocation instructions into Claude's context",
      "script": "./scripts/discover-agents.sh"
    },
    "tdd_enforcer": {
      "purpose": "Blocks production code changes if tests don't exist (Red-Green-Refactor)",
      "trigger": "PreToolUse for Write/Edit/NotebookEdit",
      "execution": "Before file is written to disk",
      "output": "Blocks and invokes tdd-orchestrator if tests missing"
    },
    "quality_gate": {
      "purpose": "Automatically runs quality checks after implementation",
      "trigger": "Stop (after Claude finishes responding)",
      "execution": "Post-implementation analysis",
      "output": "Blocks and invokes code-reviewer, security-auditor, etc."
    },
    "agent_chaining": {
      "purpose": "Chains agents together (e.g., implement → review → deploy)",
      "trigger": "SubagentStop (when subagent completes)",
      "execution": "After subagent finishes",
      "output": "Determines next agents to run"
    }
  }
}
